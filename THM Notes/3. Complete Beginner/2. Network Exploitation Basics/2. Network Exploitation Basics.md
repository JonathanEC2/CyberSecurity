# Introduction to Networking 
## OSI Model

[[../../2. Cyber Security 101/3. Networking/3. Networking## OSI model / TCP IP Model]]
## Encapsulation

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXdaf61tj85FadV73eU6F1VmWBKEB3BaT8ZM9g3oYtk6iSZSRs-w__f0K6jEochfnIfnis7w0zF036n_EzEuR3brzqJnsemrN4_D4vj8537fEHXmK7ktd7BoA3eM1mDpzPeGiHr8yVX0TKkl7eu48yVkYStY?key=TfE_5MxENIjRvhHpOZCQ2w)

As the data is passed down each layer of the model, more information containing details specific to the layer in question is added on to the start of the transmission. For example, the header added by the **Network Layer** would include things like the source and destination IP addresses, and the header added by the **Transport Layer** would include information specific to the protocol being used. The **Data Link Layer** also adds a piece on at the end of the transmission, which is used to verify that the data has not been corrupted on transmission; has the added bonus of increased security, as the data can't be intercepted and tampered with without breaking the trailer

When the message is received by the second computer, it reverses the process -- starting at the physical layer and working up until it reaches the application layer, stripping off the added information as it goes. 
### TCP/IP Encapsulation

1. **Application data**: It all starts when the user inputs the data they want to send into the application. For example, you write an email or an instant message and hit the send button. The application formats this data and starts sending it according to the application protocol used, using the layer below it, the transport layer.
2. **Transport protocol segment or datagram:** The transport layer, such as TCP or UDP, adds the proper header information and creates the TCP segment (or UDP datagram). This segment is sent to the layer below it, the network layer.
3. **Network (Internet) packet**: The network layer, i.e. the <mark style="background: #FFF3A3A6;">Internet layer</mark>, adds an IP header to the received TCP segment or UDP datagram. Then, this IP packet is sent to the layer below it, the data link layer.
4. **Data link frame**: The Ethernet or WiFi receives the IP packet and adds the proper header and trailer, creating a frame.
## TCP/IP Model 

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXfa2tW8_uNW9MtPHScVMfRnQCIk2RJAz1fn2J99DFSrhIuIVMYJ0K6JMMvMozyomwQxfmilOcBnjuVWYvp19VlKVKqi9biXxxa4dd0ZfUVdP-4wp50LjmPJyirKPYEQFs-xwG-bQbEU6zF2qegXT5w_H_A?key=TfE_5MxENIjRvhHpOZCQ2w)


<span style="color:rgb(255, 0, 0)">Ping > traceroute > whois > dig</span>


#### How DNS works
The first thing that your computer does is check its local "Hosts File" to see if an explicit IP->Domain mapping has been created.

You make a request to a website. The first thing that your computer does is check its local "Hosts File" to see if an explicit IP->Domain mapping has been created. This is an older system than DNS and much less commonly used in modern environments; however, it still takes precedence in the search order of most operating systems. If no mapping has been manually created, the computer then checks its local DNS cache to see if it already has an IP address stored for the website; if it does, great. If not, it goes to the next stage of the process.

Assuming the address hasn't already been found, your computer will then send a request to what is known as a recursive DNS server. These will automatically be known to the router on your network. Many Internet Service Providers (ISPs) maintain their recursive servers, but companies such as Google and OpenDNS also control them. This is how your computer automatically knows where to send the request for information: details for a recursive DNS server are stored in your router or computer. This server will also maintain a cache of results for popular domains; however, if the website you've requested isn't stored in the cache, the recursive server will pass the request on to a root name server.

Before 2004 there were precisely 13 root name DNS servers in the world. These days there are many more; however, they are still accessible using the same 13 IP addresses assigned to the original servers (balanced so that you get the closest server when you make a request). The root name servers essentially keep track of the DNS servers in the next level down, choosing an appropriate one to redirect your request to. These lower-level servers are called Top-Level Domain servers.

 As with root name servers, TLD servers keep track of the next level down: Authoritative name servers. When a TLD server receives your request for information, the server passes it down to an appropriate Authoritative name server.

<span style="color:rgb(255, 0, 0)">LEARN WHAT ALL THE INFO IN dig MEANS</span>

# Nmap

highly advisable to always use <span style="color:rgb(0, 176, 240)">-vv</span> nmap
<span style="color:rgb(0, 176, 240)">-p-</span> scans all ports

## TCP Scan (-sT)

If Nmap sends a TCP request with the SYN flag set to a closed port, the target server will respond with a TCP packet with the RST (Reset) flag set. By this response, Nmap can establish that the port is closed.

## SYN scans (-sS) 

Advantages
- It can be used to bypass older Intrusion Detection systems as they are looking out for a full three way handshake. This is often no longer the case with modern IDS solutions; it is for this reason that SYN scans are still frequently referred to as "stealth" scans.
- SYN scans are often not logged by applications listening on open ports, as standard practice is to log a connection once it's been fully established. Again, this plays into the idea of SYN scans being stealthy.
- Without having to bother about completing (and disconnecting from) a three-way handshake for every port, SYN scans are significantly faster than a standard TCP Connect scan.

Disadvantages

- They require sudo permissions in order to work correctly in Linux. This is because SYN scans require the ability to create raw packets (as opposed to the full TCP handshake), which is a privilege only the root user has by default.
- Unstable services are sometimes brought down by SYN scans, which could prove problematic if a client has provided a production environment for the test.

## UDP scan (-sU)

When a packet is sent to an open UDP port, there should be no response. When this happens, Nmap refers to the port as being open|filtered. When a packet is sent to a closed UDP port, the target should respond with an ICMP (ping) packet containing a message that the port is unreachable. 

UDP scans are slow. For this reason, it's usually good practice to run an Nmap scan with <span style="color:rgb(0, 176, 240)">--top-ports {number}</span> enabled.

## NULL, FIN and Xmas

Used primarily as they tend to be even stealthier, relatively speaking, than a SYN "stealth" scan;  firewall evasion. 

- <span style="color:rgb(0, 176, 240)">-sN</span> are when the TCP request is sent with no flags set at all. As per the RFC, the target host should respond with a RST if the port is closed.
- FIN scans <span style="color:rgb(0, 176, 240)">-sF</span> work in an almost identical fashion; however, instead of sending a completely empty packet, a request is sent with the FIN flag 
-  Xmas scans <span style="color:rgb(0, 176, 240)">-sX</span> send a malformed TCP packet and expects an RST response for closed ports.

## ICMP Network Scanning

- To perform a ping sweep, we use the <span style="color:rgb(0, 176, 240)">-sn</span> switch in conjunction with IP ranges

## The Nmap Scripting Engine (NSE)
<span style="color:rgb(0, 176, 240)"></span>
  
There are many categories available. Some useful categories include:

- **safe**:  Won't affect the target
- **intrusive**:  Not safe: likely to affect the target
- **vuln**: Scan for vulnerabilities
- **exploit**:  Attempt to exploit a vulnerability
- **auth**: Attempt to bypass authentication for running services (e.g. Log into an FTP server anonymously)
- **brute**: Attempt to bruteforce credentials for running services
- **discovery**:  Attempt to query running services for further information about the network (e.g. query an SNMP server).


A more exhaustive list can be found [here](https://nmap.org/book/nse-usage.html).
- To run a specific script, we would use -<span style="color:rgb(0, 176, 240)">-script={script-name}</span>, Multiple scripts can be run simultaneously in this fashion by separating them by a comma. For example:<span style="color:rgb(0, 176, 240)"> --script=smb-enum-users,smb-enum-shares</span>
- A full list of scripts and their corresponding arguments (along with example use cases) can be found **[here](https://nmap.org/nsedoc/)**

To find nmap scripts:
- The first is the page on the Nmap website 
-  local storage on your attacking machine. Nmap stores its scripts on Linux at <span style="color:rgb(0, 176, 80)">/usr/share/nmap/scripts</span>. All of the NSE scripts are stored in this directory by default -- this is where Nmap looks for scripts when you specify them.

To search for installed scripts:
- using the <span style="color:rgb(0, 176, 80)">/usr/share/nmap/scripts/script.db</span> file. we can also grep through it to look for scripts. For example: <span style="color:rgb(255, 192, 0)">grep</span> <span style="color:rgb(0, 176, 240)">"ftp"</span> <span style="color:rgb(0, 176, 80)">/usr/share/nmap/scripts/script.db</span>.
- The second way to search for scripts is quite simply to use the ls command. For example, we could get the same results as in the previous screenshot by using <span style="color:rgb(255, 192, 0)">ls</span> <span style="color:rgb(0, 176, 240)">-l</span> <span style="color:rgb(0, 176, 80)">/usr/share/nmap/scripts/*ftp*</span>

## Firewall evasion


- <span style="color:rgb(0, 176, 240)">-Pn</span>, which tells Nmap to not bother pinging the host before scanning it. This means that Nmap will always treat the target host(s) as being alive, effectively bypassing the ICMP block; however, it comes at the price of potentially taking a very long time to complete the scan
- <span style="color:rgb(0, 176, 240)">-f</span>:- Used to fragment the packets (i.e. split them into smaller pieces) making it less likely that the packets will be detected by a firewall or IDS.
- <span style="color:rgb(0, 176, 240)">--scan-delay {time} ms</span>:- used to add a delay between packets sent. This is very useful if the network is unstable, but also for evading any time-based firewall/IDS triggers which may be in place.
- <span style="color:rgb(0, 176, 240)">--badsum</span>:- this is used to generate in invalid checksums for packets. Any real TCP/IP stack would drop this packet

# Network Services
#network_services
## SMB

- SMB - Server Message Block Protocol;; **port 139 and 445**; is a client-server communication protocol used for sharing access to files, printers, serial ports and other resources on a network. response-request protocol, Clients connect to servers using TCP/IP
<!--SR:!2025-04-26,4,150-->
- Typically, there are SMB share drives on a server that can be connected to and used to view or transfer files. SMB can often be a great starting point for an attacker looking to discover sensitive information 
- <span style="color:rgb(255, 192, 0)">enum4linux</span> is a tool used to enumerate SMB shares on both Windows and Linux systems. The syntax of Enum4Linux is nice and simple: <span style="color:rgb(255, 192, 0)">enum4linux</span> <span style="color:rgb(0, 176, 240)">{options}</span> <span style="color:rgb(255, 192, 0)">IP</span>


TAG            FUNCTION
<span style="color:rgb(0, 176, 240)">-U </span>            get userlist
<span style="color:rgb(0, 176, 240)">-M </span>           get machine list
<span style="color:rgb(0, 176, 240)">-N  </span>           get namelist dump (different from -U and-M)
<span style="color:rgb(0, 176, 240)">-S </span>             get sharelist
<span style="color:rgb(0, 176, 240)">-P   </span>           get password policy information
<span style="color:rgb(0, 176, 240)">-G </span>             get group and member list
<span style="color:rgb(0, 176, 240)">-a </span>              all of the above (full basic enumeration)

-  You're more likely to encounter a situation where the best way into a system is due to misconfigurations in the system. <b><u>Exploiting anonymous SMB share access is a common misconfiguration that can allow us to gain information that will lead to a shell.</u></b>

- We can remotely access the SMB share using the syntax:
	- <span style="color:rgb(255, 192, 0)">smbclient//{IP}/{SHARE}</span> followed by<span style="color:rgb(0, 176, 240)"> -U {name}</span>: to specify the user and <span style="color:rgb(0, 176, 240)">-p {port}:</span> to specify the port
	- <span style="color:rgb(255, 0, 0)">EX</span> smbclient//10.10.10.2/secret -U suit -p 445

- <span style="color:rgb(255, 0, 0)">See if its been configured to allow anonymous access</span> by:
	- using the username "Anonymous"
	- and not supplying a password.

- Use <span style="color:rgb(255, 192, 0)">more</span> command to read the text of a file, similar to <span style="color:rgb(255, 192, 0)">cat</span>


<span style="color:rgb(255, 0, 0)">It's important to try every angle when enumerating, as the information you gather here will inform your exploitation stage.
</span>
  
## Understanding Telnet

 Telnet;; **port 23**; is an application protocol that allows you, with the use of a telnet client, to connect to and execute commands on a remote machine that's hosting a telnet server. You can connect to a telnet server with the following syntax:  <span style="color:rgb(255, 192, 0)">telnet {IP} {port}</span>
<!--SR:!2025-06-02,48,230-->

## Exploiting Telnet


- A **shell** can simply be described as a piece of code or program that can be used to gain code or command execution on a device.
- A **reverse shell** is a type of shell in which the target machine communicates back to the attacking machine.

- Start a tcpdump listener on your local machine.
	- <span style="color:rgb(255, 192, 0)">sudo tcpdump ip proto \\icmp -i tun0</span>

 - Use the command <span style="color:rgb(255, 192, 0)">ping {IP}</span> <span style="color:rgb(0, 176, 240)">-c</span> <span style="color:rgb(255, 192, 0)">1</span> through the telnet session to see if we're able to execute system commands.

- Generate a reverse shell payload using msfvenom
- Copy and paste our msfvenom payload into the telnet session and run it as a command

- netcat listener on our local machine
	- <span style="color:rgb(255, 192, 0)">nc</span> <span style="color:rgb(0, 176, 240)">-lvp</span> {listening port}

## Understanding FTP

A typical FTP session operates using two channels:
- a command (sometimes called the control) channel
- a data channel.
  
The FTP server may support either Active or Passive connections or both:
- In an Active FTP connection, the client opens a port and listens. The server is required to actively connect to it. 
- In a Passive FTP connection, the server opens a port and listens (passively) and the client connects to it. 

This separation of command information and data into separate channels is a way of being able to send commands to the server without having to wait for the current data transfer to finish.

 <span style="color:rgb(255, 192, 0)">ftp {IP}</span>

## Enumerating FTP

<span style="color:rgb(255, 0, 0)">See if its been configured to allow anonymous access</span> and if they contain any information that might allow us to pop a shell on the system. <span style="color:rgb(255, 0, 0)">This is a common pathway in CTF challenges, and mimics a real-life careless implementation of FTP servers.</span>

## Exploiting FTP

[Hydra](https://www.kali.org/tools/hydra/) is a very fast online password-cracking tool, which can perform rapid dictionary attacks against more than 50 Protocols, including Telnet, RDP, SSH, FTP, HTTP, HTTPS, SMB, several databases, and much more.

hydra -t 4 -l {user} -P /usr/share/wordlists/rockyou.txt -vV {target IP} ftp

## <span style="color:rgb(255, 0, 0)">Additional Readings</span>

Here's some things that might be useful to read after completing this room, if it interests you:

https://medium.com/@gregIT/exploiting-simple-network-services-in-ctfs-ec8735be5eef
https://attack.mitre.org/techniques/T1210/
https://www.nextgov.com/cybersecurity/2019/10/nsa-warns-vulnerabilities-multiple-vpn-services/160456/
# Network Services 2

##  Understanding NFS

NFS  (Network File System) ;;  allows a system to share directories and files with others over a network. Users can access files on remote systems as if they were local hosts. It does this by **mounting** all, or a portion, of a file system to a server
<!--SR:!2025-04-29,64,230-->

<b><font size = 4>How NFS works </font></b>
1. Client requests to mount a directory from a remote host on a local directory 
2. The remote service acts to connect to the relevant mount daemon using **RPC**
3. Server checks if the user had permission to mount whatever directory has been requested
4. Server will return a handle file which uniquely identifies each file and directory 

NFSD (nfs daemon) takes in the following RPC calls:
 - The file handle
 - The name of the file to be accessed
 - The user's, user ID
 - The user's group ID

## Enumerating NFS

<span style="color:rgb(255, 192, 0)">Nfs-common</span>;;  includes programs such as lockd, statd, showmount, nfsstat, gssd, idmapd and mount.nfs. Primarily, we are concerned with "showmount" and "mount.nfs" as these are going to be most useful to us when it comes to extracting information from the NFS share.
<!--SR:!2025-08-08,108,222-->

Mounting NFS share:
?
- <span style="color:rgb(255, 192, 0)">sudo mount -t nfs {IP}:{SHARE} /tmp/mount/ -nolock</span>
	-t nfs: Type of device to mount,  specifying that it's NFS
<!--SR:!2025-06-15,77,202-->


-  use /usr/sbin/showmount -e {target IP} to list the NFS shares
- use mkdir /tmp/mount to create a directory on your machine to mount the share to.
- By default, on NFS shares- Root Squashing is enabled, and prevents anyone connecting to the NFS share from having root access to the NFS volume.  However, if this is turned off, it can allow the creation of SUID bit files, allowing a remote user root access to the connected system.  Essentially, this means that the file or files can be run with the permissions of the file(s) owner/group. In this case, as the super-user.

## SMTP

The SMTP server performs three basic functions:
?
-  It verifies who is sending emails through the SMTP server.
-  It sends the outgoing mail
-  If the outgoing mail can't be delivered it sends the message back to the sender
<!--SR:!2025-06-27,65,190-->
  
Poorly configured or vulnerable mail servers can often provide an initial foothold into a network, but prior to launching an attack, we want to fingerprint the server to make our targeting as precise as possible. "smtp_version" and "smtp_enum” module in Metasploit

Hydra uses dictionary attacks primarily, both Kali Linux and Parrot OS have many different wordlists in the "/usr/share/wordlists" directory
## MySQL

- In its simplest definition, MySQL is a ==relational database management system (RDBMS) based on Structured Query Language (SQL).==
<!--SR:!2025-06-05,49,210-->

- A database is simply an organized collection of structured data
- RDBMS: A software or service used to create and manage databases based on a relational model. The word "relational" just means that the data stored in the dataset is organized as tables. Every table relates in some way to each other's "primary key" or other "key" factors.
- MYSQL is just a brand name for one of the most popular RDBMS software implementations. As we know, it uses a client-server model. But how do the client and server communicate? They use a language, specifically the Structured Query Language (SQL).


The server handles all database instructions like creating, editing, and accessing data. It takes and manages these requests and communicates using the MySQL protocol. This whole process can be broken down into these stages:
- MySQL creates a database for storing and manipulating data, defining the relationship of each table.
- Clients make requests by making specific statements in SQL.
- The server will respond to the client with whatever information has been requested.


In MySQL, physically, a schema is synonymous with a database. You can substitute the keyword "SCHEMA" instead of DATABASE in MySQL SQL syntax, for example using CREATE SCHEMA instead of CREATE DATABASE.

  

Useful links

 https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/security_guide/ch-exploits

https://www.nextgov.com/cybersecurity/2019/10/nsa-warns-vulnerabilities-multiple-vpn-services/160456/
